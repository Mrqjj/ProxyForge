import{_ as he,r as m,p as X,a as xe,Q as Te,c as E,o as y,d as i,e as a,t as f,w as l,f as u,i as g,D as De,s as Ce,V as Ve,J as w,h as ze,n as r,a1 as we,B as Ne,z as Pe,l as Ee,a2 as $e,m as He,a3 as Ue,W as N,O as Ae,a4 as Be,a5 as Me,E as c,L as Le}from"./index-C94CxHF3.js";import{d as Re,e as qe,f as Fe,s as We}from"./index--nyNv7zb.js";const Ze={class:"domains-page"},je={class:"page-header"},Ie={class:"header-info"},Oe={class:"filter-bar"},Xe={class:"table-container"},Ke={class:"domain-cell"},Je={class:"domain-name"},Qe={class:"visits-count"},Ye={key:1,class:"time-text"},Ge={class:"time-text"},et=["title"],tt={class:"action-buttons"},at={class:"pagination-container"},lt={key:0,class:"field-tip"},st={class:"method-tip"},nt={class:"cert-actions"},ot={key:0,class:"dns-record-tip"},it={class:"dns-record-content"},rt={__name:"Domains",setup(dt){const K=ze(),$=m(!1),H=m(!1),S=m(!1),h=m(!1),U=m(!1),A=m(!1),p=m(""),x=m(""),v=m(null),J=X(()=>({applied:"warning",verified:"success"})[p.value]||"info"),Q=X(()=>({applied:"已申请，待验证",verified:"验证成功"})[p.value]||""),B=m(""),M=m(""),V=m(1),L=m(10),k=m(0),R=m(null),n=xe({id:null,domain:"",status:"active",ssl:!1,method:"HTTP",remark:""}),Y={domain:[{required:!0,message:"请输入域名",trigger:"blur"},{pattern:/^(\*\.)?[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+$/,message:"请输入有效的域名格式，如: example.com 或 *.example.com",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}],method:[{required:!0,message:"请选择验证方式",trigger:"change"}]},q=t=>t&&t.startsWith("*."),G=t=>{p.value="",x.value="",v.value=null,t&&q(n.domain)&&(n.method="DNS",c.warning("泛解析域名只能使用 DNS 验证方式"))},ee=async()=>{const t=n.domain,e=n.method;if(!t){c.error("请先输入域名");return}if(q(t)&&e==="HTTP"){c.error("泛解析域名不支持 HTTP 验证，请使用 DNS 验证方式"),n.method="DNS";return}U.value=!0;try{const o=await qe({method:e,domain:t,token:""});o.statusCode===200?(x.value=o.data.token||o.data,p.value="applied",e==="DNS"?(v.value={domain:o.data.token,recordType:"TXT",value:o.data.authorization},c.success("申请成功，请添加 DNS TXT 记录后点击验证")):c.success("申请成功，请点击验证按钮完成验证")):c.error(o.message||"证书申请失败")}catch(o){console.error("证书申请错误:",o)}finally{U.value=!1}},te=async()=>{const t=n.domain,e=n.method;if(!x.value){c.error("请先申请证书");return}A.value=!0;try{const o=await Fe({method:e,domain:t,token:x.value});o.statusCode===200?(p.value="verified",v.value=null,c.success("证书验证成功")):c.info(o.message||"证书验证失败，请稍后重试")}catch(o){console.error("证书验证错误:",o)}finally{A.value=!1}},ae=()=>{var t;(t=v.value)!=null&&t.value&&navigator.clipboard.writeText(v.value.value).then(()=>{c.success("已复制到剪贴板")}).catch(()=>{c.error("复制失败，请手动复制")})},T=m([]),le=t=>({active:"success",inactive:"danger",pending:"warning"})[t]||"info",se=t=>({active:"正常",inactive:"已停用",pending:"审核中"})[t]||t,ne=t=>t?t>=1e6?(t/1e6).toFixed(1)+"M":t>=1e3?(t/1e3).toFixed(1)+"K":t.toString():"0",W=t=>{if(!t)return"-";const e=new Date(t);if(isNaN(e.getTime()))return t;const o=e.getFullYear(),d=String(e.getMonth()+1).padStart(2,"0"),z=String(e.getDate()).padStart(2,"0"),_=String(e.getHours()).padStart(2,"0"),P=String(e.getMinutes()).padStart(2,"0");return`${o}-${d}-${z} ${_}:${P}`},oe=t=>{if(!t)return{type:"info"};const e=new Date(t),d=Math.floor((e-new Date)/(1e3*60*60*24));return d<0?{type:"danger"}:d<20?{type:"danger"}:d<40?{type:"warning"}:{type:"success"}},D=async()=>{$.value=!0;try{const t=await Re({keyWord:B.value,status:M.value,pageNum:V.value,pageSize:L.value});t.statusCode===200?Array.isArray(t.data)?(T.value=t.data,k.value=t.data.length):t.data&&t.data.list?(T.value=t.data.list,k.value=t.data.total||t.data.list.length):(T.value=[],k.value=0):(T.value=[],k.value=0)}catch(t){console.error("获取域名列表失败:",t),T.value=[],k.value=0}finally{$.value=!1}},Z=()=>{V.value=1,D()},ie=()=>{V.value=1,D()},re=()=>{D()},de=()=>{h.value=!1,p.value="",x.value="",v.value=null,Object.assign(n,{id:null,domain:"",status:"active",ssl:!1,method:"HTTP",remark:""}),S.value=!0},ue=t=>{if(h.value=!0,x.value="",v.value=null,t.enableSsl&&t.certExpTime){const e=new Date(t.certExpTime),d=Math.floor((e-new Date)/(1e3*60*60*24));d<20?(p.value="",c.warning(`证书将在 ${d<0?"已过期":d+" 天后过期"}，建议重新申请`)):p.value="verified"}else p.value=t.enableSsl?"verified":"";Object.assign(n,{id:t.id,domain:t.domain,status:t.status,ssl:t.enableSsl,method:t.method||"HTTP",remark:t.remark||""}),S.value=!0},ce=t=>{K.push({path:"/sites",query:{domain:t.domain}})},me=t=>{Le.confirm(`确定要删除域名 "${t.domain}" 吗？删除后无法恢复。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then(()=>{const e=mockData.findIndex(o=>o.id===t.id);e>-1&&(mockData.splice(e,1),D(),c.success("删除成功"))}).catch(()=>{})},pe=async()=>{R.value&&await R.value.validate(async t=>{if(t){if(n.ssl&&q(n.domain)&&n.method==="HTTP"){c.error("泛解析域名不支持 HTTP 验证，请使用 DNS 验证方式"),n.method="DNS";return}if(n.ssl&&p.value!=="verified"){c.error("请先完成 SSL 证书申请和验证");return}H.value=!0;try{const e=await We({domain:n.domain,status:n.status,ssl:n.ssl,method:n.ssl?n.method:"",remark:n.remark||""});e.statusCode===200&&e.data>0?(c.success(h.value?"编辑成功":"添加成功"),S.value=!1,D()):c.error(e.message||"保存失败")}catch(e){console.error("提交错误:",e)}finally{H.value=!1}}})};return Te(()=>{D()}),(t,e)=>{const o=u("el-icon"),d=u("el-button"),z=u("el-input"),_=u("el-option"),P=u("el-select"),b=u("el-table-column"),F=u("el-tag"),fe=u("el-table"),ve=u("el-pagination"),j=u("el-text"),C=u("el-form-item"),ge=u("el-switch"),I=u("el-radio"),_e=u("el-radio-group"),ye=u("el-alert"),be=u("el-form"),ke=u("el-dialog"),Se=Ve("loading");return y(),E("div",Ze,[i("div",je,[i("div",Ie,[e[11]||(e[11]=i("h3",null,"域名管理",-1)),i("p",null,"共 "+f(k.value)+" 个域名",1)]),a(d,{type:"primary",onClick:de},{default:l(()=>[a(o,null,{default:l(()=>[a(g(we))]),_:1}),e[12]||(e[12]=r(" 添加域名 ",-1))]),_:1})]),i("div",Oe,[a(z,{modelValue:B.value,"onUpdate:modelValue":e[0]||(e[0]=s=>B.value=s),placeholder:"搜索域名...","prefix-icon":g(De),clearable:"",class:"search-input",onInput:Z},null,8,["modelValue","prefix-icon"]),a(P,{modelValue:M.value,"onUpdate:modelValue":e[1]||(e[1]=s=>M.value=s),placeholder:"状态筛选",clearable:"",onChange:Z},{default:l(()=>[a(_,{label:"全部状态",value:""}),a(_,{label:"正常",value:"active"}),a(_,{label:"已停用",value:"inactive"}),a(_,{label:"审核中",value:"pending"})]),_:1},8,["modelValue"])]),i("div",Xe,[Ce((y(),w(fe,{data:T.value,style:{width:"100%"}},{default:l(()=>[a(b,{prop:"domain",label:"域名",width:"180"},{default:l(({row:s})=>[i("div",Ke,[a(o,{class:"domain-icon"},{default:l(()=>[a(g(Ne))]),_:1}),i("span",Je,f(s.domain),1)])]),_:1}),a(b,{prop:"status",label:"状态"},{default:l(({row:s})=>[a(F,{type:le(s.status),effect:"dark",round:"",size:"small"},{default:l(()=>[r(f(se(s.status)),1)]),_:2},1032,["type"])]),_:1}),a(b,{prop:"enableSsl",label:"SSL证书"},{default:l(({row:s})=>[i("div",{class:Pe(["ssl-cell",s.enableSsl?"active":"inactive"])},[a(o,null,{default:l(()=>[a(g(Ee))]),_:1}),r(" "+f(s.enableSsl?"已启用":"未启用"),1)],2)]),_:1}),a(b,{prop:"visits",label:"访问量"},{default:l(({row:s})=>[i("span",Qe,f(ne(s.visits||0)),1)]),_:1}),a(b,{prop:"certExpTime",label:"证书到期"},{default:l(({row:s})=>[s.enableSsl&&s.certExpTime?(y(),w(F,{key:0,type:oe(s.certExpTime).type,effect:"dark",round:""},{default:l(()=>[r(f(W(s.certExpTime)),1)]),_:2},1032,["type"])):(y(),E("span",Ye,"-"))]),_:1}),a(b,{prop:"createTime",label:"添加时间"},{default:l(({row:s})=>[i("span",Ge,f(W(s.createTime)),1)]),_:1}),a(b,{prop:"remark",label:"备注",width:"320"},{default:l(({row:s})=>[i("span",{class:"remark-text",title:s.remark},f(s.remark||"-"),9,et)]),_:1}),a(b,{label:"操作",width:"260",fixed:"right",align:"center","header-align":"center"},{default:l(({row:s})=>[i("div",tt,[a(d,{type:"primary",size:"small",onClick:O=>ue(s)},{default:l(()=>[a(o,null,{default:l(()=>[a(g($e))]),_:1}),e[13]||(e[13]=r(" 编辑 ",-1))]),_:1},8,["onClick"]),a(d,{type:"success",size:"small",onClick:O=>ce(s)},{default:l(()=>[a(o,null,{default:l(()=>[a(g(He))]),_:1}),e[14]||(e[14]=r(" 站点 ",-1))]),_:1},8,["onClick"]),a(d,{type:"danger",size:"small",onClick:O=>me(s)},{default:l(()=>[a(o,null,{default:l(()=>[a(g(Ue))]),_:1}),e[15]||(e[15]=r(" 删除 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[Se,$.value]]),i("div",at,[a(ve,{"current-page":V.value,"onUpdate:currentPage":e[2]||(e[2]=s=>V.value=s),"page-size":L.value,"onUpdate:pageSize":e[3]||(e[3]=s=>L.value=s),"page-sizes":[10,20,50,100],total:k.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ie,onCurrentChange:re},null,8,["current-page","page-size","total"])])]),a(ke,{modelValue:S.value,"onUpdate:modelValue":e[10]||(e[10]=s=>S.value=s),title:h.value?"编辑域名":"添加域名",width:"500px","destroy-on-close":""},{footer:l(()=>[a(d,{onClick:e[9]||(e[9]=s=>S.value=!1)},{default:l(()=>[...e[29]||(e[29]=[r("取消",-1)])]),_:1}),a(d,{type:"primary",loading:H.value,onClick:pe},{default:l(()=>[...e[30]||(e[30]=[r(" 确定 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[a(be,{ref_key:"formRef",ref:R,model:n,rules:Y,"label-width":"80px"},{default:l(()=>[a(C,{label:"域名",prop:"domain"},{default:l(()=>[a(z,{modelValue:n.domain,"onUpdate:modelValue":e[4]||(e[4]=s=>n.domain=s),placeholder:"请输入域名,如:example.com|a.example.com|*.example.com",disabled:h.value},null,8,["modelValue","disabled"]),h.value?(y(),E("div",lt,[a(j,{type:"info",size:"small"},{default:l(()=>[...e[16]||(e[16]=[r("域名添加后不可修改",-1)])]),_:1})])):N("",!0)]),_:1}),a(C,{label:"状态",prop:"status"},{default:l(()=>[a(P,{modelValue:n.status,"onUpdate:modelValue":e[5]||(e[5]=s=>n.status=s),placeholder:"请选择状态",style:{width:"100%"}},{default:l(()=>[a(_,{label:"正常",value:"active"}),a(_,{label:"已停用",value:"inactive"}),a(_,{label:"审核中",value:"pending"})]),_:1},8,["modelValue"])]),_:1}),a(C,{label:"SSL证书",prop:"ssl"},{default:l(()=>[a(ge,{modelValue:n.ssl,"onUpdate:modelValue":e[6]||(e[6]=s=>n.ssl=s),onChange:G},null,8,["modelValue"])]),_:1}),n.ssl?(y(),w(C,{key:0,label:"验证方式",prop:"method"},{default:l(()=>[a(_e,{modelValue:n.method,"onUpdate:modelValue":e[7]||(e[7]=s=>n.method=s),disabled:p.value==="verified"},{default:l(()=>[a(I,{label:"HTTP"},{default:l(()=>[...e[17]||(e[17]=[r("HTTP 验证",-1)])]),_:1}),a(I,{label:"DNS"},{default:l(()=>[...e[18]||(e[18]=[r("DNS 验证",-1)])]),_:1})]),_:1},8,["modelValue","disabled"]),i("div",st,[a(j,{type:"info",size:"small"},{default:l(()=>[r(f(n.method==="HTTP"?"需要域名可访问，不支持泛解析(*.domain.com)":"需要添加TXT记录，支持泛解析"),1)]),_:1})])]),_:1})):N("",!0),n.ssl?(y(),w(C,{key:1,label:"证书操作"},{default:l(()=>[i("div",nt,[a(d,{type:"primary",loading:U.value,disabled:!n.domain||p.value==="verified",onClick:ee},{default:l(()=>[a(o,null,{default:l(()=>[a(g(Ae))]),_:1}),e[19]||(e[19]=r(" 申请证书 ",-1))]),_:1},8,["loading","disabled"]),a(d,{type:"success",loading:A.value,disabled:p.value!=="applied",onClick:te},{default:l(()=>[a(o,null,{default:l(()=>[a(g(Be))]),_:1}),e[20]||(e[20]=r(" 验证证书 ",-1))]),_:1},8,["loading","disabled"]),p.value?(y(),w(F,{key:0,type:J.value,effect:"dark",class:"cert-status-tag"},{default:l(()=>[r(f(Q.value),1)]),_:1},8,["type"])):N("",!0)]),p.value==="applied"&&n.method==="DNS"&&v.value?(y(),E("div",ot,[a(ye,{type:"warning",closable:!1,"show-icon":""},{title:l(()=>[...e[21]||(e[21]=[i("span",null,"请添加 DNS 解析记录",-1)])]),default:l(()=>[i("div",it,[i("p",null,[e[22]||(e[22]=i("strong",null,"主机记录:",-1)),e[23]||(e[23]=r()),i("code",null,f(v.value.domain),1)]),i("p",null,[e[24]||(e[24]=i("strong",null,"记录类型:",-1)),e[25]||(e[25]=r()),i("code",null,f(v.value.recordType),1)]),i("p",null,[e[26]||(e[26]=i("strong",null,"记录值:",-1)),e[27]||(e[27]=r()),i("code",null,f(v.value.value),1)]),a(d,{size:"small",type:"primary",link:"",onClick:ae},{default:l(()=>[a(o,null,{default:l(()=>[a(g(Me))]),_:1}),e[28]||(e[28]=r(" 复制记录值 ",-1))]),_:1})])]),_:1})])):N("",!0)]),_:1})):N("",!0),a(C,{label:"备注",prop:"remark"},{default:l(()=>[a(z,{modelValue:n.remark,"onUpdate:modelValue":e[8]||(e[8]=s=>n.remark=s),type:"textarea",rows:3,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},mt=he(rt,[["__scopeId","data-v-c01c3e95"]]);export{mt as default};
