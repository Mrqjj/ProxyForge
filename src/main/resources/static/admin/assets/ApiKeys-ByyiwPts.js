import{_ as ie,r,a as ne,Q as se,c as oe,o as T,d as s,e as t,w as i,f as o,i as b,D as re,s as de,V as ue,J as ce,n as u,a1 as pe,t as v,a5 as me,a2 as ge,a3 as fe,E as c,L as ve}from"./index-BQoz9wsR.js";import{w as _e,x as ye,y as be}from"./index-mp-WL5tY.js";const he={class:"api-keys-page"},Ce={class:"page-header"},Ve={class:"filter-bar"},Ae={class:"table-container"},Ke={class:"api-key-cell"},xe={class:"key-text"},we={class:"credits-info"},Pe={class:"remaining"},ke={class:"total"},ze={class:"time-text"},Ie={class:"action-buttons"},Ue={class:"pagination-container"},Re={__name:"ApiKeys",setup(De){const V=r(!1),A=r(!1),p=r(!1),_=r(!1),K=r(""),x=r(null),y=r(1),w=r(10),z=r(0),I=r([]),P=r(null),n=ne({id:null,provider:"",apiKey:"",initialCredits:0,creditsRemaining:0,isActive:!0,notes:""}),$={provider:[{required:!0,message:"请选择服务商",trigger:"change"}],apiKey:[{required:!0,message:"请输入 API Key",trigger:"blur"}]},L=l=>({"ipinfo.io":"primary","ipregistry.co":"success"})[l]||"info",M=l=>l?l.length<=8?l:l.substring(0,4)+"****"+l.substring(l.length-4):"-",j=async l=>{try{await navigator.clipboard.writeText(l),c.success("已复制到剪贴板")}catch{c.error("复制失败")}},U=l=>l==null?"-":l.toLocaleString(),R=l=>!l.initialCredits||l.initialCredits===0?0:Math.round(l.creditsRemaining/l.initialCredits*100),q=l=>{const e=R(l);return e<=10?"exception":e<=30?"warning":"success"},O=l=>l?new Date(l).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",m=async()=>{V.value=!0;try{const l=await _e({keyWord:K.value,status:x.value,pageNum:y.value,pageSize:w.value});l.statusCode===200&&(I.value=l.data||[],z.value=l.total||0)}catch(l){console.error("获取数据失败:",l)}finally{V.value=!1}},D=()=>{y.value=1,m()},F=()=>{y.value=1,m()},J=()=>{m()},Q=()=>{_.value=!1,Object.assign(n,{id:null,provider:"",apiKey:"",initialCredits:0,creditsRemaining:0,isActive:!0,notes:""}),p.value=!0},W=l=>{_.value=!0,Object.assign(n,{id:l.id,provider:l.provider,apiKey:l.apiKey,initialCredits:l.initialCredits||0,creditsRemaining:l.creditsRemaining||0,isActive:l.isActive,notes:l.notes||""}),p.value=!0},G=async l=>{try{await ve.confirm(`确定要删除 ${l.provider} 的 API Key 吗？`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"});const e=await ye(l.id);e.statusCode===200?(c.success("删除成功"),m()):c.error(e.message||"删除失败")}catch(e){e!=="cancel"&&console.error("删除失败:",e)}},H=async()=>{P.value&&await P.value.validate(async l=>{if(l){A.value=!0;try{const e=await be(n);e.statusCode===200?(c.success(_.value?"编辑成功":"添加成功"),p.value=!1,m()):c.error(e.message||"保存失败")}catch(e){console.error("保存失败:",e),c.error("保存失败")}finally{A.value=!1}}})};return se(()=>{m()}),(l,e)=>{const h=o("el-icon"),g=o("el-button"),k=o("el-input"),C=o("el-option"),S=o("el-select"),B=o("el-tag"),d=o("el-table-column"),X=o("el-progress"),Y=o("el-table"),Z=o("el-pagination"),f=o("el-form-item"),E=o("el-input-number"),ee=o("el-switch"),te=o("el-form"),le=o("el-dialog"),ae=ue("loading");return T(),oe("div",he,[s("div",Ce,[e[13]||(e[13]=s("div",{class:"header-info"},[s("h3",null,"API Key 管理"),s("p",null,"管理 IP 查询服务的 API 密钥")],-1)),t(g,{type:"primary",onClick:Q},{default:i(()=>[t(h,null,{default:i(()=>[t(b(pe))]),_:1}),e[12]||(e[12]=u(" 添加 API Key ",-1))]),_:1})]),s("div",Ve,[t(k,{modelValue:K.value,"onUpdate:modelValue":e[0]||(e[0]=a=>K.value=a),placeholder:"搜索 API Key / 备注...","prefix-icon":b(re),clearable:"",class:"search-input",onInput:D},null,8,["modelValue","prefix-icon"]),t(S,{modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=a=>x.value=a),placeholder:"状态筛选",clearable:"",onChange:D},{default:i(()=>[t(C,{label:"全部状态",value:null}),t(C,{label:"启用",value:!0}),t(C,{label:"禁用",value:!1})]),_:1},8,["modelValue"])]),s("div",Ae,[de((T(),ce(Y,{data:I.value,class:"api-table"},{default:i(()=>[t(d,{prop:"provider",label:"服务商",width:"100",align:"center","header-align":"center"},{default:i(({row:a})=>[t(B,{type:L(a.provider),effect:"dark"},{default:i(()=>[u(v(a.provider),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"apiKey",label:"API Key","min-width":"100",align:"center","header-align":"center"},{default:i(({row:a})=>[s("div",Ke,[s("span",xe,v(M(a.apiKey)),1),t(g,{type:"info",size:"small",circle:"",onClick:N=>j(a.apiKey)},{default:i(()=>[t(h,null,{default:i(()=>[t(b(me))]),_:1})]),_:1},8,["onClick"])])]),_:1}),t(d,{label:"额度",width:"160",align:"center","header-align":"center"},{default:i(({row:a})=>[s("div",we,[s("span",Pe,v(U(a.creditsRemaining)),1),e[14]||(e[14]=s("span",{class:"separator"},"/",-1)),s("span",ke,v(U(a.initialCredits)),1)]),t(X,{percentage:R(a),"stroke-width":4,"show-text":!1,status:q(a)},null,8,["percentage","status"])]),_:1}),t(d,{prop:"isActive",label:"状态",width:"150",align:"center","header-align":"center"},{default:i(({row:a})=>[t(B,{type:a.isActive?"success":"danger",size:"small"},{default:i(()=>[u(v(a.isActive?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"lastUsedAt",label:"最后使用",width:"240",align:"center","header-align":"center"},{default:i(({row:a})=>[s("span",ze,v(O(a.lastUsedAt)),1)]),_:1}),t(d,{prop:"notes",label:"备注","min-width":"150",align:"center","header-align":"center","show-overflow-tooltip":""}),t(d,{label:"操作",width:"200",align:"center","header-align":"center",fixed:"right"},{default:i(({row:a})=>[s("div",Ie,[t(g,{type:"primary",size:"small",onClick:N=>W(a)},{default:i(()=>[t(h,null,{default:i(()=>[t(b(ge))]),_:1}),e[15]||(e[15]=u(" 编辑 ",-1))]),_:1},8,["onClick"]),t(g,{type:"danger",size:"small",onClick:N=>G(a)},{default:i(()=>[t(h,null,{default:i(()=>[t(b(fe))]),_:1}),e[16]||(e[16]=u(" 删除 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[ae,V.value]]),s("div",Ue,[t(Z,{"current-page":y.value,"onUpdate:currentPage":e[2]||(e[2]=a=>y.value=a),"page-size":w.value,"onUpdate:pageSize":e[3]||(e[3]=a=>w.value=a),"page-sizes":[10,20,50],total:z.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:F,onCurrentChange:J},null,8,["current-page","page-size","total"])])]),t(le,{modelValue:p.value,"onUpdate:modelValue":e[11]||(e[11]=a=>p.value=a),title:_.value?"编辑 API Key":"添加 API Key",width:"500px","destroy-on-close":""},{footer:i(()=>[t(g,{onClick:e[10]||(e[10]=a=>p.value=!1)},{default:i(()=>[...e[17]||(e[17]=[u("取消",-1)])]),_:1}),t(g,{type:"primary",loading:A.value,onClick:H},{default:i(()=>[...e[18]||(e[18]=[u(" 确定 ",-1)])]),_:1},8,["loading"])]),default:i(()=>[t(te,{ref_key:"formRef",ref:P,model:n,rules:$,"label-width":"100px"},{default:i(()=>[t(f,{label:"服务商",prop:"provider"},{default:i(()=>[t(S,{modelValue:n.provider,"onUpdate:modelValue":e[4]||(e[4]=a=>n.provider=a),placeholder:"请选择服务商",style:{width:"100%"},disabled:_.value},{default:i(()=>[t(C,{label:"ipregistry.co",value:"ipregistry.co"})]),_:1},8,["modelValue","disabled"])]),_:1}),t(f,{label:"API Key",prop:"apiKey"},{default:i(()=>[t(k,{modelValue:n.apiKey,"onUpdate:modelValue":e[5]||(e[5]=a=>n.apiKey=a),placeholder:"请输入 API Key","show-password":""},null,8,["modelValue"])]),_:1}),t(f,{label:"初始额度",prop:"initialCredits"},{default:i(()=>[t(E,{modelValue:n.initialCredits,"onUpdate:modelValue":e[6]||(e[6]=a=>n.initialCredits=a),min:0,max:999999999,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(f,{label:"剩余额度",prop:"creditsRemaining"},{default:i(()=>[t(E,{modelValue:n.creditsRemaining,"onUpdate:modelValue":e[7]||(e[7]=a=>n.creditsRemaining=a),min:0,max:999999999,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(f,{label:"状态",prop:"isActive"},{default:i(()=>[t(ee,{modelValue:n.isActive,"onUpdate:modelValue":e[8]||(e[8]=a=>n.isActive=a),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1}),t(f,{label:"备注",prop:"notes"},{default:i(()=>[t(k,{modelValue:n.notes,"onUpdate:modelValue":e[9]||(e[9]=a=>n.notes=a),type:"textarea",rows:3,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Ee=ie(Re,[["__scopeId","data-v-f94f30d8"]]);export{Ee as default};
