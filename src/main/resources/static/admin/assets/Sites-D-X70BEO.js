import{_ as ve,r as u,a as be,Q as ye,q as Ve,c,o as i,d as o,s as ke,W as I,e as a,t as g,w as n,f as d,i as f,D as we,V as he,S as U,U as R,h as Ce,n as p,a1 as xe,J as z,X as Se,g as Ue,a6 as ze,a2 as Be,O as De,a7 as $e,a8 as Me,a3 as Ne,a9 as Te,L as K,E as b}from"./index-BQoz9wsR.js";import{h as qe,i as Ee,j as Fe,k as Re}from"./index-mp-WL5tY.js";const Le={class:"sites-page"},We={class:"page-header"},Ae={class:"header-info"},Pe={class:"filter-bar"},Ge={class:"sites-grid"},Ie=["onClick"],Ke={class:"card-header"},Oe={class:"site-info"},je={class:"site-url"},Je={class:"card-stats"},Qe={class:"stat-item plugin-info"},Xe={class:"stat-value plugin-name"},He={class:"plugin-detail"},Ye={key:1,class:"stat-value no-plugin"},Ze={class:"card-footer"},ea=["title"],aa={key:0,class:"empty-state"},ta={key:0,class:"pagination-container"},la={__name:"Sites",setup(na){const L=Ve(),w=Ce(),h=u(!1),O=u(!1),B=u(!1),j=u(!1),D=u(""),C=u(""),$=u(""),y=u(1),M=u(12),N=u(0),J=u(null),m=be({id:null,name:"",domain:"",path:"/",status:"running",description:""}),Q={name:[{required:!0,message:"请输入站点名称",trigger:"blur"},{min:2,max:50,message:"名称长度在 2 到 50 个字符",trigger:"blur"}],domain:[{required:!0,message:"请选择所属域名",trigger:"change"}],path:[{required:!0,message:"请输入站点路径",trigger:"blur"}]},T=u([]),x=u([]),W=["linear-gradient(135deg, #6366f1, #8b5cf6)","linear-gradient(135deg, #10b981, #34d399)","linear-gradient(135deg, #f59e0b, #fbbf24)","linear-gradient(135deg, #3b82f6, #60a5fa)","linear-gradient(135deg, #ec4899, #f472b6)","linear-gradient(135deg, #14b8a6, #2dd4bf)","linear-gradient(135deg, #f97316, #fb923c)","linear-gradient(135deg, #8b5cf6, #a78bfa)"],X=l=>W[l%W.length],H=l=>({running:"success",stopped:"danger",maintenance:"warning"})[l]||"info",Y=l=>({running:"运行中",stopped:"已停止",maintenance:"维护中"})[l]||l,Z=l=>l||"-",ee=l=>{if(!l||l===0)return"0 B";const e=1024,s=["B","KB","MB","GB"],r=Math.floor(Math.log(l)/Math.log(e));return parseFloat((l/Math.pow(e,r)).toFixed(2))+" "+s[r]},v=async()=>{h.value=!0;try{const l=await Ee({keyWord:D.value,domain:C.value||"",status:$.value,pageNum:y.value,pageSize:M.value});l.statusCode===200&&(x.value=l.data||[],N.value=l.total||0)}catch(l){console.error("获取站点列表失败:",l)}finally{h.value=!1}},q=()=>{y.value=1,v()},ae=()=>{y.value=1,v()},te=()=>{v()},A=()=>{w.push("/sites/add")},le=l=>{w.push(`/sites/edit/${l.id}`)},ne=(l,e)=>{switch(l){case"edit":oe(e);break;case"logs":se(e);break;case"start":P(e,"running");break;case"stop":P(e,"stopped");break;case"delete":de(e);break}},oe=l=>{w.push(`/sites/edit/${l.id}`)},se=l=>{w.push(`/sites/logs/${l.id}`)},P=async(l,e)=>{const s=e==="running"?"启动":"停止";try{await K.confirm(`确定要${s}站点 "${l.name}" 吗？`,`${s}确认`,{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const r=await Re({id:l.id,name:l.name,domain:l.domain,targetUrl:l.targetUrl,status:e});r.statusCode===200?(b.success(`${s}成功`),v()):b.error(r.message||`${s}失败`)}catch(r){r!=="cancel"&&(console.error("操作失败:",r),b.error(`${s}失败`))}},de=async l=>{try{await K.confirm(`确定要删除站点 "${l.name}" 吗？删除后无法恢复。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"});const e=await Fe({id:l.id,domain:l.domain});e.statusCode===200?(b.success("删除成功"),v()):b.error(e.message||"删除失败")}catch(e){e!=="cancel"&&(console.error("删除失败:",e),b.error("删除失败"))}},re=async()=>{try{const l=await qe();l.statusCode===200&&l.data&&(T.value=l.data)}catch(l){console.error("获取域名列表失败:",l)}};return ye(()=>{L.query.domain&&(C.value=L.query.domain),re(),v()}),(l,e)=>{const s=d("el-icon"),r=d("el-button"),S=d("el-input"),_=d("el-option"),E=d("el-select"),V=d("el-dropdown-item"),ie=d("el-dropdown-menu"),ue=d("el-dropdown"),pe=d("el-tag"),me=d("el-pagination"),k=d("el-form-item"),F=d("el-radio"),ce=d("el-radio-group"),ge=d("el-form"),fe=d("el-dialog"),_e=he("loading");return i(),c("div",Le,[o("div",We,[o("div",Ae,[e[13]||(e[13]=o("h3",null,"站点管理",-1)),o("p",null,"共 "+g(N.value)+" 个站点",1)]),a(r,{type:"primary",onClick:A},{default:n(()=>[a(s,null,{default:n(()=>[a(f(xe))]),_:1}),e[14]||(e[14]=p(" 添加站点 ",-1))]),_:1})]),o("div",Pe,[a(S,{modelValue:D.value,"onUpdate:modelValue":e[0]||(e[0]=t=>D.value=t),placeholder:"搜索站点名称...","prefix-icon":f(we),clearable:"",class:"search-input",onInput:q},null,8,["modelValue","prefix-icon"]),a(E,{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=t=>C.value=t),placeholder:"选择域名",clearable:"",onChange:q},{default:n(()=>[a(_,{label:"全部域名",value:""}),(i(!0),c(U,null,R(T.value,t=>(i(),z(_,{key:t.id,label:t.domain,value:t.domain},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(E,{modelValue:$.value,"onUpdate:modelValue":e[2]||(e[2]=t=>$.value=t),placeholder:"状态筛选",clearable:"",onChange:q},{default:n(()=>[a(_,{label:"全部状态",value:""}),a(_,{label:"运行中",value:"running"}),a(_,{label:"已停止",value:"stopped"}),a(_,{label:"维护中",value:"maintenance"})]),_:1},8,["modelValue"])]),ke((i(),c("div",Ge,[(i(!0),c(U,null,R(x.value,t=>(i(),c("div",{class:"site-card",key:t.id,onClick:G=>le(t)},[o("div",Ke,[o("div",{class:"site-icon",style:Se({background:X(t.id)})},g(t.name.charAt(0).toUpperCase()),5),o("div",Oe,[o("h4",null,g(t.name),1),o("span",je,g(Z(t.domain)),1)]),a(ue,{trigger:"click",onCommand:G=>ne(G,t)},{dropdown:n(()=>[a(ie,null,{default:n(()=>[a(V,{command:"edit"},{default:n(()=>[a(s,null,{default:n(()=>[a(f(Be))]),_:1}),e[15]||(e[15]=p(" 编辑 ",-1))]),_:1}),a(V,{command:"logs"},{default:n(()=>[a(s,null,{default:n(()=>[a(f(De))]),_:1}),e[16]||(e[16]=p(" 实时日志 ",-1))]),_:1}),t.status==="running"?(i(),z(V,{key:0,command:"stop"},{default:n(()=>[a(s,null,{default:n(()=>[a(f($e))]),_:1}),e[17]||(e[17]=p(" 停止 ",-1))]),_:1})):(i(),z(V,{key:1,command:"start"},{default:n(()=>[a(s,null,{default:n(()=>[a(f(Me))]),_:1}),e[18]||(e[18]=p(" 启动 ",-1))]),_:1})),a(V,{command:"delete",divided:""},{default:n(()=>[a(s,null,{default:n(()=>[a(f(Ne))]),_:1}),e[19]||(e[19]=p(" 删除 ",-1))]),_:1})]),_:2},1024)]),default:n(()=>[a(r,{icon:f(ze),circle:"",text:"",onClick:e[3]||(e[3]=Ue(()=>{},["stop"]))},null,8,["icon"])]),_:2},1032,["onCommand"])]),o("div",Je,[o("div",Qe,[e[20]||(e[20]=o("span",{class:"stat-label"},"插件信息",-1)),t.pluginName?(i(),c(U,{key:0},[o("span",Xe,g(t.pluginName),1),o("span",He,"v"+g(t.pluginVersion)+" · "+g(ee(t.pluginSize)),1)],64)):(i(),c("span",Ye,"无"))])]),o("div",Ze,[a(pe,{type:H(t.status),effect:"dark",size:"small",round:""},{default:n(()=>[e[21]||(e[21]=o("span",{class:"status-dot"},null,-1)),p(" "+g(Y(t.status)),1)]),_:2},1032,["type"]),o("span",{class:"target-url",title:t.targetUrl},g(t.targetUrl),9,ea)])],8,Ie))),128)),!h.value&&x.value.length===0?(i(),c("div",aa,[a(s,{size:64},{default:n(()=>[a(f(Te))]),_:1}),e[23]||(e[23]=o("p",null,"暂无站点数据",-1)),a(r,{type:"primary",onClick:A},{default:n(()=>[...e[22]||(e[22]=[p("添加站点",-1)])]),_:1})])):I("",!0)])),[[_e,h.value]]),x.value.length>0?(i(),c("div",ta,[a(me,{"current-page":y.value,"onUpdate:currentPage":e[4]||(e[4]=t=>y.value=t),"page-size":M.value,"onUpdate:pageSize":e[5]||(e[5]=t=>M.value=t),"page-sizes":[12,24,48],total:N.value,layout:"total, sizes, prev, pager, next",onSizeChange:ae,onCurrentChange:te},null,8,["current-page","page-size","total"])])):I("",!0),a(fe,{modelValue:B.value,"onUpdate:modelValue":e[12]||(e[12]=t=>B.value=t),title:j.value?"编辑站点":"添加站点",width:"550px","destroy-on-close":""},{footer:n(()=>[a(r,{onClick:e[11]||(e[11]=t=>B.value=!1)},{default:n(()=>[...e[27]||(e[27]=[p("取消",-1)])]),_:1}),a(r,{type:"primary",loading:O.value,onClick:l.handleSubmit},{default:n(()=>[...e[28]||(e[28]=[p(" 确定 ",-1)])]),_:1},8,["loading","onClick"])]),default:n(()=>[a(ge,{ref_key:"formRef",ref:J,model:m,rules:Q,"label-width":"100px"},{default:n(()=>[a(k,{label:"站点名称",prop:"name"},{default:n(()=>[a(S,{modelValue:m.name,"onUpdate:modelValue":e[6]||(e[6]=t=>m.name=t),placeholder:"请输入站点名称"},null,8,["modelValue"])]),_:1}),a(k,{label:"所属域名",prop:"domain"},{default:n(()=>[a(E,{modelValue:m.domain,"onUpdate:modelValue":e[7]||(e[7]=t=>m.domain=t),placeholder:"请选择域名",style:{width:"100%"}},{default:n(()=>[(i(!0),c(U,null,R(T.value,t=>(i(),z(_,{key:t.id,label:t.domain,value:t.domain},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(k,{label:"站点路径",prop:"path"},{default:n(()=>[a(S,{modelValue:m.path,"onUpdate:modelValue":e[8]||(e[8]=t=>m.path=t),placeholder:"如：/blog 或 /"},null,8,["modelValue"])]),_:1}),a(k,{label:"状态",prop:"status"},{default:n(()=>[a(ce,{modelValue:m.status,"onUpdate:modelValue":e[9]||(e[9]=t=>m.status=t)},{default:n(()=>[a(F,{label:"running"},{default:n(()=>[...e[24]||(e[24]=[p("运行中",-1)])]),_:1}),a(F,{label:"stopped"},{default:n(()=>[...e[25]||(e[25]=[p("已停止",-1)])]),_:1}),a(F,{label:"maintenance"},{default:n(()=>[...e[26]||(e[26]=[p("维护中",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(k,{label:"描述",prop:"description"},{default:n(()=>[a(S,{modelValue:m.description,"onUpdate:modelValue":e[10]||(e[10]=t=>m.description=t),type:"textarea",rows:3,placeholder:"请输入站点描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},da=ve(la,[["__scopeId","data-v-12166499"]]);export{da as default};
