import{_ as X,r as i,a as Y,Q as Z,c as ee,o as v,d as r,e as t,w as n,f as s,s as te,V as le,J as y,n as f,i as k,a1 as ae,as as ne,t as $,a2 as oe,a3 as se,W as ie,L as re,E as V}from"./index-C94CxHF3.js";import{z as ue,A as de,B as pe}from"./index--nyNv7zb.js";const ce={class:"whitelist-page"},fe={class:"page-header"},me={class:"table-container"},_e={class:"ip-cell"},ge={class:"ip-text"},ve={class:"action-buttons"},be={class:"pagination-container"},he={class:"form-tip"},ye={__name:"WhiteList",setup(Ve){const w=i(!1),z=i(!1),_=i(!1),b=i(!1),C=i(1),P=i(10),B=i(0),L=i([]),g=i("permanent"),I=i(null),o=Y({ip:"",ttl:-1,notes:""}),D={ip:[{required:!0,message:"请输入 IP 地址",trigger:"blur"},{pattern:/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,message:"请输入有效的 IP 地址格式",trigger:"blur"}]},E=l=>{if(l==="permanent")o.ttl=-1;else if(l==="custom")o.ttl=3600;else{const e={"1h":3600,"6h":21600,"12h":43200,"1d":86400,"7d":604800,"30d":2592e3};o.ttl=e[l]}},U=l=>l===-1?"success":l<=0||l<=3600?"danger":l<=24*3600?"warning":"success",S=l=>{if(l===-1)return"永久有效";if(l<=0)return"已过期";const e=Math.floor(l/(24*3600)),d=Math.floor(l%(24*3600)/3600),p=Math.floor(l%3600/60),m=l%60,u=[];return e>0&&u.push(`${e}天`),d>0&&u.push(`${d}小时`),p>0&&e===0&&u.push(`${p}分`),m>0&&e===0&&d===0&&u.push(`${m}秒`),u.join("")||"0秒"},h=async()=>{w.value=!0;try{const l=await ue({pageNum:C.value,pageSize:P.value});l.statusCode===200&&(L.value=l.data||[],B.value=l.total||0)}catch(l){console.error("获取数据失败:",l)}finally{w.value=!1}},M=()=>{C.value=1,h()},W=()=>{h()},N=()=>{b.value=!1,g.value="permanent",Object.assign(o,{ip:"",ttl:-1,notes:""}),_.value=!0},j=l=>{b.value=!0,Object.assign(o,{ip:l.ip,ttl:l.ttl,notes:l.notes||""}),l.ttl===-1?g.value="permanent":g.value="custom",_.value=!0},O=async l=>{try{await re.confirm(`确定要删除 IP 地址 ${l.ip} 吗？`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"});const e=await de(l.ip);e.statusCode===200?(V.success("删除成功"),h()):V.error(e.message||"删除失败")}catch(e){e!=="cancel"&&console.error("删除失败:",e)}},R=async()=>{I.value&&await I.value.validate(async l=>{if(l){z.value=!0;try{const e=await pe(o);e.statusCode===200?(V.success(b.value?"编辑成功":"添加成功"),_.value=!1,h()):V.error(e.message||"保存失败")}catch(e){console.error("保存失败:",e),V.error("保存失败")}finally{z.value=!1}}})};return Z(()=>{h()}),(l,e)=>{const d=s("el-icon"),p=s("el-button"),m=s("el-table-column"),u=s("el-tag"),A=s("el-table"),q=s("el-pagination"),T=s("el-input"),x=s("el-form-item"),c=s("el-option"),J=s("el-select"),Q=s("el-input-number"),F=s("el-form"),G=s("el-dialog"),H=le("loading");return v(),ee("div",ce,[r("div",fe,[e[9]||(e[9]=r("div",{class:"header-info"},[r("h3",null,"IP 白名单"),r("p",null,"管理允许访问的 IP 地址白名单")],-1)),t(p,{type:"primary",onClick:N},{default:n(()=>[t(d,null,{default:n(()=>[t(k(ae))]),_:1}),e[8]||(e[8]=f(" 添加白名单 ",-1))]),_:1})]),r("div",me,[te((v(),y(A,{data:L.value,class:"whitelist-table"},{default:n(()=>[t(m,{prop:"ip",label:"IP 地址",width:"180",align:"center","header-align":"center"},{default:n(({row:a})=>[r("div",_e,[t(d,null,{default:n(()=>[t(k(ne))]),_:1}),r("span",ge,$(a.ip),1)])]),_:1}),t(m,{prop:"ttl",label:"剩余过期时间",width:"180",align:"center","header-align":"center"},{default:n(({row:a})=>[a.ttl===-1?(v(),y(u,{key:0,type:"success",size:"small"},{default:n(()=>[...e[10]||(e[10]=[f("永久有效",-1)])]),_:1})):a.ttl>0?(v(),y(u,{key:1,type:U(a.ttl),size:"small"},{default:n(()=>[f($(S(a.ttl)),1)]),_:2},1032,["type"])):(v(),y(u,{key:2,type:"danger",size:"small"},{default:n(()=>[...e[11]||(e[11]=[f("已过期",-1)])]),_:1}))]),_:1}),t(m,{prop:"notes",label:"备注","min-width":"150",align:"center","header-align":"center","show-overflow-tooltip":""}),t(m,{label:"操作",width:"160",align:"center","header-align":"center",fixed:"right"},{default:n(({row:a})=>[r("div",ve,[t(p,{type:"primary",size:"small",onClick:K=>j(a)},{default:n(()=>[t(d,null,{default:n(()=>[t(k(oe))]),_:1}),e[12]||(e[12]=f(" 编辑 ",-1))]),_:1},8,["onClick"]),t(p,{type:"danger",size:"small",onClick:K=>O(a)},{default:n(()=>[t(d,null,{default:n(()=>[t(k(se))]),_:1}),e[13]||(e[13]=f(" 删除 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[H,w.value]]),r("div",be,[t(q,{"current-page":C.value,"onUpdate:currentPage":e[0]||(e[0]=a=>C.value=a),"page-size":P.value,"onUpdate:pageSize":e[1]||(e[1]=a=>P.value=a),"page-sizes":[10,20,50],total:B.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:M,onCurrentChange:W},null,8,["current-page","page-size","total"])])]),t(G,{modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=a=>_.value=a),title:b.value?"编辑白名单":"添加白名单",width:"500px","destroy-on-close":""},{footer:n(()=>[t(p,{onClick:e[6]||(e[6]=a=>_.value=!1)},{default:n(()=>[...e[14]||(e[14]=[f("取消",-1)])]),_:1}),t(p,{type:"primary",loading:z.value,onClick:R},{default:n(()=>[...e[15]||(e[15]=[f(" 确定 ",-1)])]),_:1},8,["loading"])]),default:n(()=>[t(F,{ref_key:"formRef",ref:I,model:o,rules:D,"label-width":"100px"},{default:n(()=>[t(x,{label:"IP 地址",prop:"ip"},{default:n(()=>[t(T,{modelValue:o.ip,"onUpdate:modelValue":e[2]||(e[2]=a=>o.ip=a),placeholder:"请输入 IP 地址，如: 192.168.1.1",disabled:b.value},null,8,["modelValue","disabled"])]),_:1}),t(x,{label:"有效期",prop:"ttl"},{default:n(()=>[t(J,{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=a=>g.value=a),placeholder:"选择有效期",style:{width:"100%"},onChange:E},{default:n(()=>[t(c,{label:"永久有效",value:"permanent"}),t(c,{label:"1 小时",value:"1h"}),t(c,{label:"6 小时",value:"6h"}),t(c,{label:"12 小时",value:"12h"}),t(c,{label:"1 天",value:"1d"}),t(c,{label:"7 天",value:"7d"}),t(c,{label:"30 天",value:"30d"}),t(c,{label:"自定义秒数",value:"custom"})]),_:1},8,["modelValue"])]),_:1}),g.value==="custom"?(v(),y(x,{key:0,label:"TTL (秒)",prop:"customTtl"},{default:n(()=>[t(Q,{modelValue:o.ttl,"onUpdate:modelValue":e[4]||(e[4]=a=>o.ttl=a),min:1,max:31536e3,step:3600,"controls-position":"right",style:{width:"100%"},placeholder:"请输入有效时间（秒）"},null,8,["modelValue"]),r("div",he,"当前设置："+$(S(o.ttl)),1)]),_:1})):ie("",!0),t(x,{label:"备注",prop:"notes"},{default:n(()=>[t(T,{modelValue:o.notes,"onUpdate:modelValue":e[5]||(e[5]=a=>o.notes=a),type:"textarea",rows:3,placeholder:"请输入备注信息（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ke=X(ye,[["__scopeId","data-v-2bdd4f8a"]]);export{ke as default};
