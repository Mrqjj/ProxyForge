import{_ as X,r as c,a as S,Q as Y,c as Z,o as z,d as s,e as t,w as l,f as i,E as d,J as ee,W as te,i as m,B as le,n as f,ab as ae,ay as oe,C as ne,t as B,a2 as se,a3 as re,as as ue,a1 as ie,L as de}from"./index-C94CxHF3.js";import{o as pe,p as fe,q as ce,r as me,t as ve}from"./index--nyNv7zb.js";const ye={class:"settings-page"},_e={class:"settings-container"},ge={class:"settings-column"},we={class:"card-header"},be={class:"settings-column"},xe={class:"card-header"},Ce={class:"header-left"},Re={class:"url-rules-list"},Ve={class:"url-code"},Ue={__name:"Settings",setup(Te){const R=c(null),b=c(!1),a=S({defaultUrl:"",analyticsCode:"",cacheTime:300,autoRenew:!1,renewDays:7}),E={defaultUrl:[{pattern:/^(https?:\/\/)?([\da-z.-]+)\.([a-z.]{2,6})([\/\w .-]*)*\/?$/,message:"请输入有效的URL地址",trigger:"blur"}]},_=c([]),g=c(!1),x=c(!1),C=c(-1),V=c(!1),U=c(null),u=S({urlPattern:"",contentType:"text/html",responseContent:""}),N={urlPattern:[{required:!0,message:"请输入URL匹配路径",trigger:"blur"}],contentType:[{required:!0,message:"请选择响应类型",trigger:"change"}],responseContent:[{required:!0,message:"请输入响应内容",trigger:"blur"}]},j=()=>{x.value=!1,C.value=-1,u.urlPattern="",u.contentType="text/html",u.responseContent="",g.value=!0},q=o=>{x.value=!0,C.value=o;const e=_.value[o];u.urlPattern=e.urlPattern,u.contentType=e.contentType||"text/html",u.responseContent=e.responseContent,g.value=!0},F=async o=>{const e=_.value[o];if(!(e!=null&&e.id)){d.error("规则ID不存在");return}try{await de.confirm("确定要删除这条拦截规则吗？","删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"});const r=await me(e.id);r.statusCode===200?(d.success("删除成功"),await T()):d.error(r.message||"删除失败")}catch(r){r!=="cancel"&&(console.error("删除规则失败:",r),d.error("删除失败"))}},G=async()=>{U.value&&await U.value.validate(async o=>{var e;if(o){V.value=!0;try{const r={urlPattern:u.urlPattern,contentType:u.contentType,responseContent:u.responseContent};x.value&&((e=_.value[C.value])!=null&&e.id)&&(r.id=_.value[C.value].id);const v=await ve(r);v.statusCode===200?(d.success(x.value?"修改成功":"添加成功"),g.value=!1,await T()):d.error(v.message||"保存失败")}catch(r){console.error("保存规则失败:",r),d.error("保存失败")}finally{V.value=!1}}})},M=async()=>{b.value=!0;try{const o=await pe();o.statusCode===200&&o.data&&(a.defaultUrl=o.data.defaultUrl||"",a.analyticsCode=o.data.analyticsCode||"",a.cacheTime=o.data.cacheTime??300,a.autoRenew=o.data.autoRenew||!1,a.renewDays=o.data.renewDays||7)}catch(o){console.error("获取配置失败:",o),d.error("获取配置失败")}finally{b.value=!1}},T=async()=>{try{const o=await fe();o.statusCode===200&&(_.value=o.data||[])}catch(o){console.error("获取规则失败:",o)}},I=async()=>{R.value&&await R.value.validate(async o=>{if(o){b.value=!0;try{const e=await ce({defaultUrl:a.defaultUrl,analyticsCode:a.analyticsCode,cacheTime:a.cacheTime,autoRenew:a.autoRenew,renewDays:a.renewDays});e.statusCode===200&&e.data===!0?d.success("保存成功"):d.error(e.message||"保存失败")}catch(e){console.error("保存配置失败:",e),d.error("保存失败")}finally{b.value=!1}}})},$=()=>{a.defaultUrl="",a.analyticsCode="",a.cacheTime=300,a.autoRenew=!1,a.renewDays=7,d.info("已重置")};return Y(()=>{M(),T()}),(o,e)=>{const r=i("el-icon"),v=i("el-input"),p=i("el-form-item"),D=i("el-input-number"),A=i("el-divider"),J=i("el-switch"),y=i("el-button"),L=i("el-form"),h=i("el-card"),k=i("el-table-column"),H=i("el-tag"),O=i("el-table"),w=i("el-option"),Q=i("el-select"),W=i("el-dialog");return z(),Z("div",ye,[e[29]||(e[29]=s("div",{class:"page-header"},[s("div",{class:"header-info"},[s("h3",null,"全局配置"),s("p",null,"系统全局参数配置")])],-1)),s("div",_e,[s("div",ge,[t(h,{class:"settings-card"},{header:l(()=>[s("div",we,[t(r,null,{default:l(()=>[t(m(ne))]),_:1}),e[10]||(e[10]=s("span",null,"基础配置",-1))])]),default:l(()=>[t(L,{ref_key:"formRef",ref:R,model:a,rules:E,"label-width":"120px","label-position":"left"},{default:l(()=>[t(p,{label:"默认跳转地址",prop:"defaultUrl"},{default:l(()=>[t(v,{modelValue:a.defaultUrl,"onUpdate:modelValue":e[0]||(e[0]=n=>a.defaultUrl=n),placeholder:"请输入默认跳转URL，如: https://example.com",clearable:""},{prefix:l(()=>[t(r,null,{default:l(()=>[t(m(le))]),_:1})]),_:1},8,["modelValue"]),e[11]||(e[11]=s("div",{class:"form-tip"},"当访问无效域名时，将自动跳转到此地址, 也支持 /xxxx.html",-1))]),_:1}),t(p,{label:"统计代码",prop:"analyticsCode"},{default:l(()=>[t(v,{modelValue:a.analyticsCode,"onUpdate:modelValue":e[1]||(e[1]=n=>a.analyticsCode=n),type:"textarea",rows:8,placeholder:"请输入统计代码，如: Google Analytics、百度统计等代码",resize:"vertical"},null,8,["modelValue"]),e[12]||(e[12]=s("div",{class:"form-tip"},"统计代码将自动插入到所有页面的 <head> 标签中",-1))]),_:1}),t(p,{label:"默认缓存时间",prop:"cacheTime"},{default:l(()=>[t(D,{modelValue:a.cacheTime,"onUpdate:modelValue":e[2]||(e[2]=n=>a.cacheTime=n),min:0,max:86400,step:60,"controls-position":"right"},null,8,["modelValue"]),e[13]||(e[13]=s("span",{class:"input-suffix"},"秒",-1)),e[14]||(e[14]=s("div",{class:"form-tip"},"全局默认缓存时间，0 表示不缓存，建议设置 300-3600 秒",-1))]),_:1}),t(A,{"content-position":"left"},{default:l(()=>[...e[15]||(e[15]=[f("证书续签设置",-1)])]),_:1}),t(p,{label:"自动续签"},{default:l(()=>[t(J,{modelValue:a.autoRenew,"onUpdate:modelValue":e[3]||(e[3]=n=>a.autoRenew=n),"active-text":"开启","inactive-text":"关闭"},null,8,["modelValue"]),e[16]||(e[16]=s("div",{class:"form-tip"},"开启后，系统将在证书到期前自动续签",-1))]),_:1}),a.autoRenew?(z(),ee(p,{key:0,label:"提前续签天数",prop:"renewDays"},{default:l(()=>[t(D,{modelValue:a.renewDays,"onUpdate:modelValue":e[4]||(e[4]=n=>a.renewDays=n),min:1,max:90,step:1,"controls-position":"right"},null,8,["modelValue"]),e[17]||(e[17]=s("span",{class:"input-suffix"},"天",-1)),e[18]||(e[18]=s("div",{class:"form-tip"},"证书到期前多少天开始自动续签，建议设置 7-30 天",-1))]),_:1})):te("",!0),t(p,null,{default:l(()=>[t(y,{type:"primary",loading:b.value,onClick:I},{default:l(()=>[t(r,null,{default:l(()=>[t(m(ae))]),_:1}),e[19]||(e[19]=f(" 保存配置 ",-1))]),_:1},8,["loading"]),t(y,{onClick:$},{default:l(()=>[t(r,null,{default:l(()=>[t(m(oe))]),_:1}),e[20]||(e[20]=f(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),s("div",be,[t(h,{class:"settings-card url-intercept-card"},{header:l(()=>[s("div",xe,[s("div",Ce,[t(r,null,{default:l(()=>[t(m(ue))]),_:1}),e[21]||(e[21]=s("span",null,"URL 全局替换规则",-1))]),t(y,{type:"primary",size:"small",onClick:j},{default:l(()=>[t(r,null,{default:l(()=>[t(m(ie))]),_:1}),e[22]||(e[22]=f(" 添加规则 ",-1))]),_:1})])]),default:l(()=>[s("div",Re,[e[25]||(e[25]=s("div",{class:"form-tip",style:{"margin-bottom":"16px"}}," 配置 URL 拦截规则，当访问匹配的 URL 时，返回指定的响应内容, 不进入任何站点 ",-1)),t(O,{data:_.value,style:{width:"100%"},"empty-text":"暂无拦截规则"},{default:l(()=>[t(k,{prop:"urlPattern",label:"URL 匹配","min-width":"180"},{default:l(({row:n})=>[s("code",Ve,B(n.urlPattern),1)]),_:1}),t(k,{prop:"contentType",label:"响应类型",width:"150"},{default:l(({row:n})=>[t(H,{size:"small",effect:"plain"},{default:l(()=>[f(B(n.contentType),1)]),_:2},1024)]),_:1}),t(k,{label:"操作",width:"140",fixed:"right"},{default:l(({row:n,$index:P})=>[t(y,{type:"primary",link:"",size:"small",onClick:K=>q(P)},{default:l(()=>[t(r,null,{default:l(()=>[t(m(se))]),_:1}),e[23]||(e[23]=f(" 编辑 ",-1))]),_:1},8,["onClick"]),t(y,{type:"danger",link:"",size:"small",onClick:K=>F(P)},{default:l(()=>[t(r,null,{default:l(()=>[t(m(re))]),_:1}),e[24]||(e[24]=f(" 删除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1})])]),t(W,{modelValue:g.value,"onUpdate:modelValue":e[9]||(e[9]=n=>g.value=n),title:x.value?"编辑拦截规则":"添加拦截规则",width:"600px","destroy-on-close":""},{footer:l(()=>[t(y,{onClick:e[8]||(e[8]=n=>g.value=!1)},{default:l(()=>[...e[27]||(e[27]=[f("取消",-1)])]),_:1}),t(y,{type:"primary",loading:V.value,onClick:G},{default:l(()=>[...e[28]||(e[28]=[f(" 确定 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[t(L,{ref_key:"ruleFormRef",ref:U,model:u,rules:N,"label-width":"100px"},{default:l(()=>[t(p,{label:"URL 匹配",prop:"urlPattern"},{default:l(()=>[t(v,{modelValue:u.urlPattern,"onUpdate:modelValue":e[5]||(e[5]=n=>u.urlPattern=n),placeholder:"请输入URL路径，如: /.well-known/acme-challenge/abc123"},null,8,["modelValue"]),e[26]||(e[26]=s("div",{class:"form-tip"},"精确匹配 URL 路径，不支持通配符",-1))]),_:1}),t(p,{label:"响应类型",prop:"contentType"},{default:l(()=>[t(Q,{modelValue:u.contentType,"onUpdate:modelValue":e[6]||(e[6]=n=>u.contentType=n),placeholder:"请选择响应类型",style:{width:"100%"}},{default:l(()=>[t(w,{label:"text/html",value:"text/html"}),t(w,{label:"text/plain",value:"text/plain"}),t(w,{label:"application/json",value:"application/json"}),t(w,{label:"application/xml",value:"application/xml"}),t(w,{label:"text/css",value:"text/css"}),t(w,{label:"application/javascript",value:"application/javascript"})]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"响应内容",prop:"responseContent"},{default:l(()=>[t(v,{modelValue:u.responseContent,"onUpdate:modelValue":e[7]||(e[7]=n=>u.responseContent=n),type:"textarea",rows:10,placeholder:"请输入响应内容，可以是文本、JSON、HTML等",resize:"vertical"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Le=X(Ue,[["__scopeId","data-v-3b97291d"]]);export{Le as default};
